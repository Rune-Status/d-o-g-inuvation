package org.rspeer.game.api;

import org.rspeer.api.commons.Time;
import org.rspeer.game.adapter.component.InterfaceComponent;
import org.rspeer.game.api.component.InterfaceAddress;
import org.rspeer.game.api.component.Interfaces;
import org.rspeer.game.providers.RSQuestDefinition;

public enum Quest {

    TOWER_OF_LIFE(1),
    ROCKING_OUT(4),
    DEATH_TO_THE_DORGESHUUN(13),
    ERNEST_THE_CHICKEN(15),
    WATCHTOWER(16),
    ROMEO_AND_JULIET(17),
    THE_TALE_OF_THE_MUSPAH(18),
    SWEPT_AWAY(20),
    IN_AID_OF_THE_MYREQUE(21),
    CATAPULT_CONSTRUCTION(23),
    LUNAR_DIPLOMACY(24),
    THE_RESTLESS_GHOST(27),
    MURDER_MYSTERY(28),
    ALL_FIRED_UP(29),
    RECIPE_FOR_DISASTER(30),
    FUR_N_SEEK(33),
    DWARF_CANNON(34),
    FORGIVENESS_OF_A_CHAOS_DWARF(35),
    A_SOULS_BANE(36),
    THE_LOST_TRIBE(37),
    SHEEP_HERDER(39),
    TRIBAL_TOTEM(40),
    ANIMAL_MAGNETISM(43),
    CLOCK_TOWER(44),
    A_TAIL_OF_TWO_CATS(45),
    SPIRITS_OF_THE_ELID(46),
    DEMON_SLAYER(51),
    BLACK_KNIGHTS_FORTRESS(53),
    //    RUNE_MYSTERIES(55),
    DEFENDER_OF_VARROCK(56),
    PLAGUE_CITY(58),
    JUNGLE_POTION(59),
    PIRATES_TREASURE(60),
    KINGS_RANSOM(61),
    RECRUITMENT_DRIVE(62),
    SHIELD_OF_ARRAV(63),
    DRAGON_SLAYER(66),
    RAG_AND_BONE_MAN(68),
    SHILO_VILLAGE(70),
    SHADOW_OF_THE_STORM(71),
    IMP_CATCHER(72),
    MYTHS_OF_THE_WHITE_LANDS(74),
    EADGARS_RUSE(75),
    FISHING_CONTEST(76),
    MISSING_MY_MUMMY(77),
    DREAM_MENTOR(79),
    TEARS_OF_GUTHIX(81),
    GHOSTS_AHOY(82),
    A_VOID_DANCE(83),
    TROLL_STRONGHOLD(85),
    WHILE_GUTHIX_SLEEPS(86),
    IN_PYRE_NEED(87),
    TROLL_ROMANCE(90),
    CREATURE_OF_FENKENSTRAIN(92),
    WATERFALL_QUEST(93),
    SUMMERS_END(95),
    ENAKHRAS_LAMENT(97),
    RUM_DEAL(101),
    BIG_CHOMPY_BIRD_HUNTING(102),
    ZOGRE_FLESH_EATERS(104),
    MERLINS_CRYSTAL(108),
    ROVING_ELVES(110),
    DRUIDIC_RITUAL(111),
    HOLY_GRAIL(112),
    THE_CHOSEN_COMMANDER(114),
    GLORIOUS_MEMORIES(115),
    FAMILY_CREST(116),
    THE_CURSE_OF_ARRAV(117),
    HAUNTED_MINE(120),
    SEA_SLUG(121),
    DEVIOUS_MINDS(123),
    MAKING_HISTORY(124),
    HAZEEL_CULT(125),
    TEMPLE_OF_IKOV(126),
    ROYAL_TROUBLE(127),
    BIOHAZARD(128),
    MONKEY_MADNESS(130),
    UNSTABLE_FOUNDATIONS(131),
    NATURE_SPIRIT(133),
    DESERT_TREASURE(135),
    GOBLIN_DIPLOMACY(137),
    GERTRUDES_CAT(138),
    DEATH_PLATEAU(140),
    MEETING_HISTORY(142),
    WHAT_LIES_BELOW(144),
    COLD_WAR(145),
    ONE_SMALL_FAVOUR(146),
    THE_FREMENNIK_ISLES(148),
    EAGLES_PEAK(149),
    MOUNTAIN_DAUGHTER(151),
    ANOTHER_SLICE_OF_HAM(155),
    WITHIN_THE_LIGHT(167),
    NOMADS_REQUIEM(170),
    RUNE_MECHANICS(171),
    SHEEP_SHEARER(173),
    WITCHS_POTION(178),
    O_LITTLE_TOWN_OF_DAEMONHEIM(181),
    ACHIEVEMENT_SYSTEM(182),
    PARTYING_IS_SUCH_SWEET_SORROW(184),
    KING_OF_THE_DWARVES(185),
    THE_PRISONER_OF_GLOUPHRIE(186),
    A_CLOCKWORK_SYRINGE(188),
    HOLLY(189),
    HAWTHORN(190),
    RITUAL_OF_THE_MAHJARRAT(194),
    DEATHCON_II(195),
    ONE_PIERCING_NOTE(196),
    TURKEY_PROTEST(197),
    SOME_LIKE_IT_COLD(204),
    A_STRAY_IN_A_MANGER(211),
    BIRTHRIGHT_OF_THE_DWARVES(215),
    PLAGUES_END(222),
    HEART_OF_STONE(224),
    TUTORIAL(256),
    COOKS_ASSISTANT(257),
    VAMPYRE_SLAYER(258),
    PRINCE_ALI_RESCUE(259),
    DORICS_QUEST(260),
    THE_KNIGHTS_SWORD(261),
    LOST_CITY(262),
    WITCHS_HOUSE(263),
    HEROES_QUEST(264),
    SCORPION_CATCHER(265),
    MONKS_FRIEND(266),
    TREE_GNOME_VILLAGE(267),
    FIGHT_ARENA(268),
    THE_GRAND_TREE(269),
    UNDERGROUND_PASS(270),
    OBSERVATORY_QUEST(271),
    THE_TOURIST_TRAP(272),
    THE_DIG_SITE(273),
    LEGENDS_QUEST(274),
    ELEMENTAL_WORKSHOP_I(275),
    PRIEST_IN_PERIL(276),
    TAI_BWO_WANNAI_TRIO(277),
    REGICIDE(278),
    SHADES_OF_MORTTON(279),
    THE_FREMENNIK_TRIALS(280),
    HORROR_FROM_THE_DEEP(281),
    THRONE_OF_MISCELLANIA(282),
    IN_SEARCH_OF_THE_MYREQUE(283),
    BETWEEN_A_ROCK(284),
    THE_FEUD(285),
    THE_GOLEM(286),
    ICTHLARINS_LITTLE_HELPER(287),
    THE_GIANT_DWARF(288),
    MOURNINGS_END_PART_I(289),
    FORGETTABLE_TALE_OF_A_DRUNKEN_DWARF(290),
    GARDEN_OF_TRANQUILLITY(291),
    WANTED(292),
    MOURNINGS_END_PART_II(293),
    RAT_CATCHERS(294),
    THE_HAND_IN_THE_SAND(295),
    CABIN_FEVER(296),
    A_FAIRY_TALE_I_GROWING_PAINS(297),
    RECIPE_FOR_DISASTER_ANOTHER_COOKS_QUEST(298),
    RECIPE_FOR_DISASTER_FREEING_THE_MOUNTAIN_DWARF(299),
    RECIPE_FOR_DISASTER_FREEING_THE_GOBLIN_GENERALS(300),
    RECIPE_FOR_DISASTER_FREEING_PIRATE_PETE(301),
    RECIPE_FOR_DISASTER_FREEING_THE_LUMBRIDGE_SAGE(302),
    RECIPE_FOR_DISASTER_FREEING_EVIL_DAVE(303),
    RECIPE_FOR_DISASTER_FREEING_SKRACH_UGLOGWEE(304),
    RECIPE_FOR_DISASTER_FREEING_SIR_AMIK_VARZE(305),
    RECIPE_FOR_DISASTER_FREEING_KING_AWOWOGEI(306),
    RECIPE_FOR_DISASTER_DEFEATING_THE_CULINAROMANCER(307),
    SWAN_SONG(308),
    A_FAIRY_TALE_II_CURE_A_QUEEN(309),
    THE_EYES_OF_GLOUPHRIE(310),
    THE_DARKNESS_OF_HALLOWVALE(311),
    THE_SLUG_MENACE(312),
    ELEMENTAL_WORKSHOP_II(313),
    MY_ARMS_BIG_ADVENTURE(314),
    ENLIGHTENED_JOURNEY(315),
    CONTACT(316),
    THE_GREAT_BRAIN_ROBBERY(317),
    OLAFS_QUEST(318),
    GRIM_TALES(319),
    THE_PATH_OF_GLOUPHRIE(320),
    BACK_TO_MY_ROOTS(321),
    LAND_OF_THE_GOBLINS(322),
    DEALING_WITH_SCABARAS(323),
    WOLF_WHISTLE(324),
    AS_A_FIRST_RESORT(325),
    KENNITHS_CONCERNS(326),
    LEGACY_OF_SEERGAZE(327),
    PERILS_OF_ICE_MOUNTAIN(328),
    TOKTZ_KET_DILL(329),
    SMOKING_KILLS(330),
    SPIRIT_OF_SUMMER(331),
    HUNT_FOR_RED_RAKTUBER(332),
    THE_TEMPLE_AT_SENNTISTEN(333),
    BLOOD_RUNS_DEEP(334),
    THE_BLOOD_PACT(335),
    BUYERS_AND_CELLARS(336),
    A_FAIRY_TALE_III_BATTLE_AT_ORKS_RIFT(337),
    ELEMENTAL_WORKSHOP_III(338),
    QUIET_BEFORE_THE_SWARM(339),
    LOVE_STORY(340),
    GUNNARS_GROUND(341),
    THE_VOID_STARES_BACK(342),
    DO_NO_EVIL(343),
    ELEMENTAL_WORKSHOP_IV(344),
    DEADLIEST_CATCH(345),
    SALT_IN_THE_WOUND(346),
    THE_BRANCHES_OF_DARKMEYER(347),
    A_TOWERING_FEAST(348),
    THE_FIREMAKERS_CURSE(349),
    LET_THEM_EAT_PIE(350),
    THE_ELDER_KILN(351),
    SONG_FROM_THE_DEPTHS(352),
    CARNILLEAN_RISING(353),
    //    CARNILLEAN_RISING(354),
    STOLEN_HEARTS(355),
    DIAMOND_IN_THE_ROUGH(356),
    WHATS_MINE_IS_YOURS(357),
    RUNE_MYSTERIES(358),
    RUNE_MEMORIES(359),
    THE_BRINK_OF_EXTINCTION(360),
    THE_WORLD_WAKES(361),
    BRINGING_HOME_THE_BACON(362),
    THE_DEATH_OF_CHIVALRY(363),
    MISSING_PRESUMED_DEATH(364),
    ONE_OF_A_KIND(365),
    FATE_OF_THE_GODS(366),
    A_SHADOW_OVER_ASHDALE(367),
    THE_MIGHTY_FALL(368),
    BROKEN_HOME(369),
    DISHONOUR_AMONG_THIEVES(370),
    DIMENSION_OF_DISASTER(371),
    DIMENSION_OF_DISASTER_COIN_OF_THE_REALM(372),
    DIMENSION_OF_DISASTER_SHIELD_OF_ARRAV(373),
    DIMENSION_OF_DISASTER_DEMON_SLAYER(374),
    DIMENSION_OF_DISASTER_DEFENDER_OF_VARROCK(375),
    DIMENSION_OF_DISASTER_CURSE_OF_ARRAV(376),
    HEROS_WELCOME(377),
    THE_LIGHT_WITHIN(378),
    THE_LORD_OF_VAMPYRIUM(379),
    CALL_OF_THE_ANCESTORS(380),
    BENEATH_CURSED_TIDES(381),
    NOMADS_ELEGY(382),
    RIVER_OF_BLOOD(383),
    KINDRED_SPIRITS(384),
    GOWER_QUEST(385),
    CHILDREN_OF_MAH(386),
    IMPRESSING_THE_LOCALS(387),
    SLISKES_ENDGAME(388),
    BACK_TO_THE_FREEZER(389),
    THE_JACK_OF_SPADES(390),
    CROCODILE_TEARS(391),
    OUR_MAN_IN_THE_NORTH(392),
    PHITE_CLUB(393),
    GHOST_STORIES_OF_GIELINOR(394),
    EVIL_DAVES_BIG_DAY_OUT(395),
    THE_GNOME_PROJECT(396),
    PIECES_OF_HATE(397),
    YOU_ARE_IT(398),
    THE_NEEDLE_SKIPS(399),
    VIOLET_IS_BLUE(400),
    CHEFS_ASSISTANT(401);

    private static final InterfaceAddress ACCEPT = new InterfaceAddress(() -> Interfaces.getComponent(1500, 404)); // 403
    private final RSQuestDefinition definition;

    Quest(int idx) {
        definition = Game.getClient().getQuestDefinitionLoader().load(idx);
    }

    public static boolean isInterfaceOpen() {
        return Interfaces.isVisible(ACCEPT);
    }

    public static boolean accept() {
        return ACCEPT.filter(InterfaceComponent::isVisible)
                .mapToBoolean(x -> x.interact("Select"))
                && Time.sleepUntil(() -> !isInterfaceOpen(), 2000);
    }

    public boolean isCompleted() {
        return definition.isCompleted(Game.getClient().getPlayerFacade());
    }

    public int getCurrent() {
        return getStateVariableAt(0);
    }

    public int getMinimum() {
        return getStateVariableAt(1);
    }

    public int getMaximum() {
        return getStateVariableAt(2);
    }

    private int getStateVariableAt(int index) {
        if (definition.getVarpBits() != null) {
            return Varps.getBitValue(definition.getVarpBits()[0][index]);
        } else if (definition.getVarps() != null) {
            return Varps.getValue(definition.getVarps()[0][index]);
        }
        return -1;
    }
}
